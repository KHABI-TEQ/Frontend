# New Preference Form - API Payloads

This document shows the complete API payloads generated by the new preference form for each property type.

## Base Payload Structure

All preference payloads share a common base structure:

```typescript
interface BasePayload {
  preferenceType: "buy" | "rent" | "joint-venture" | "shortlet";
  preferenceMode: "buy" | "tenant" | "developer" | "shortlet";
  location: {
    state: string;
    localGovernmentAreas: string[];
    selectedAreas: string[];
    customLocation?: string;
  };
  budget: {
    minPrice: number;
    maxPrice: number;
    currency: "NGN";
  };
  features: {
    baseFeatures: string[];
    premiumFeatures: string[];
    autoAdjustToFeatures: boolean;
  };
  contactInfo: {
    fullName?: string;
    email: string;
    phoneNumber: string;
    // JV specific fields
    companyName?: string;
    contactPerson?: string;
    cacRegistrationNumber?: string;
  };
}
```

## 1. Buy Property Preference Payload

**Endpoint:** `POST /buyers/submit-preference`

```json
{
  "preferenceType": "buy",
  "preferenceMode": "buy",
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Ikeja", "Eti-Osa"],
    "selectedAreas": [
      "Victoria Island - Eti-Osa",
      "Lekki - Eti-Osa",
      "Ikeja GRA - Ikeja"
    ],
    "customLocation": null
  },
  "budget": {
    "minPrice": 50000000,
    "maxPrice": 100000000,
    "currency": "NGN"
  },
  "propertyDetails": {
    "propertyType": "Residential",
    "buildingType": "Detached",
    "minBedrooms": "4",
    "minBathrooms": 3,
    "propertyCondition": "New",
    "purpose": "For living"
  },
  "features": {
    "baseFeatures": ["Parking", "Borehole", "Security", "Power Supply"],
    "premiumFeatures": ["Swimming Pool", "Gym"],
    "autoAdjustToFeatures": true
  },
  "contactInfo": {
    "fullName": "John Doe",
    "email": "john.doe@example.com",
    "phoneNumber": "+234801234567"
  },
  "nearbyLandmark": "Close to Ikeja Mall",
  "additionalNotes": "Prefer properties with good ventilation"
}
```

### Buy Property Features Available:

- **Basic Features:** Parking, Borehole, Security, Power Supply, Water Supply
- **Premium Features:** Swimming Pool (₦30M+), Gym (₦30M+), Walk-in Closet (₦25M+), Smart Home Features (₦40M+)

---

## 2. Rent Property Preference Payload

**Endpoint:** `POST /buyers/submit-preference`

```json
{
  "preferenceType": "rent",
  "preferenceMode": "tenant",
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Surulere", "Yaba"],
    "selectedAreas": ["Surulere Central - Surulere", "Yaba - Lagos Mainland"],
    "customLocation": null
  },
  "budget": {
    "minPrice": 500000,
    "maxPrice": 1200000,
    "currency": "NGN"
  },
  "propertyDetails": {
    "propertyType": "Flat",
    "minBedrooms": "2",
    "leaseTerm": "1 Year",
    "propertyCondition": "New",
    "purpose": "Residential"
  },
  "features": {
    "baseFeatures": ["Parking", "Power Supply", "Clean Water", "Security"],
    "premiumFeatures": ["Gated Estate", "Furnished"],
    "autoAdjustToFeatures": false
  },
  "contactInfo": {
    "fullName": "Jane Smith",
    "email": "jane.smith@example.com",
    "phoneNumber": "+234901234567"
  },
  "additionalNotes": "Pet-friendly apartment preferred"
}
```

### Rent Property Features Available:

- **Basic Features:** Parking, Power Supply, Clean Water, Security, Accessibility to Road
- **Premium Features:** Gated Estate (₦500K+), Furnished (₦800K+), Serviced Apartment (₦1M+), Backup Generator (₦400K+)

---

## 3. Joint Venture Preference Payload

**Endpoint:** `POST /buyers/submit-preference`

```json
{
  "preferenceType": "joint-venture",
  "preferenceMode": "developer",
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Ibeju-Lekki"],
    "selectedAreas": ["Sangotedo - Ibeju-Lekki", "Lakowe - Ibeju-Lekki"],
    "customLocation": null
  },
  "budget": {
    "minPrice": 20000000,
    "maxPrice": 50000000,
    "currency": "NGN"
  },
  "developmentDetails": {
    "minLandSize": "4 plots",
    "jvType": "Equity Split",
    "propertyType": "Land",
    "expectedStructureType": "Mini Flats",
    "timeline": "Ready Now",
    "budgetRange": 35000000
  },
  "features": {
    "baseFeatures": [
      "Titled Land",
      "Dry Land",
      "Accessible Road",
      "Within Urban Zone"
    ],
    "premiumFeatures": ["Existing Drawings", "Fenced Land"],
    "autoAdjustToFeatures": true
  },
  "contactInfo": {
    "companyName": "ABC Development Ltd",
    "contactPerson": "Michael Johnson",
    "email": "m.johnson@abcdev.com",
    "phoneNumber": "+234701234567",
    "cacRegistrationNumber": "RC123456"
  },
  "partnerExpectations": "Looking for experienced developers with proven track record"
}
```

### Joint Venture Features Available:

- **Basic Features:** Titled Land, Dry Land, Accessible Road, Within Urban Zone
- **Premium Features:** Existing Drawings (₦10M+), Fenced Land (₦5M+), High-Demand Area (₦20M+)

---

## 4. Shortlet Preference Payload

**Endpoint:** `POST /buyers/submit-preference`

```json
{
  "preferenceType": "shortlet",
  "preferenceMode": "shortlet",
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Eti-Osa"],
    "selectedAreas": ["Victoria Island - Eti-Osa", "Ikoyi - Eti-Osa"],
    "customLocation": null
  },
  "budget": {
    "minPrice": 35000,
    "maxPrice": 80000,
    "currency": "NGN"
  },
  "bookingDetails": {
    "propertyType": "1-Bed Apartment",
    "minBedrooms": "1",
    "numberOfGuests": 2,
    "checkInDate": "2024-01-15",
    "checkOutDate": "2024-01-20"
  },
  "features": {
    "baseFeatures": [
      "Wi-Fi",
      "Power Supply",
      "Clean Bathroom",
      "AC",
      "Kitchen"
    ],
    "premiumFeatures": ["Smart TV / Netflix", "Swimming Pool", "Housekeeping"],
    "autoAdjustToFeatures": false
  },
  "contactInfo": {
    "fullName": "Sarah Williams",
    "email": "sarah.w@example.com",
    "phoneNumber": "+234811234567"
  },
  "additionalNotes": "Anniversary celebration, prefer romantic setup"
}
```

### Shortlet Features Available:

- **Basic Features:** Wi-Fi, Power Supply, Clean Bathroom, AC, Kitchen
- **Premium Features:** Smart TV/Netflix (₦50K+), Gym (₦80K+), Swimming Pool (₦100K+), Housekeeping (₦60K+)

---

## Location Data Structure

The location section allows users to select:

1. **State** (Single selection from Nigerian states)
2. **LGAs** (Multi-select from Local Government Areas in selected state)
3. **Areas** (Multi-select from areas in selected LGAs, max 3 areas)
4. **Custom Location** (Free text when areas not found in dropdown)

### Example Location Data:

```json
{
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Ikeja", "Eti-Osa", "Lagos Island"],
    "selectedAreas": [
      "Victoria Island - Eti-Osa",
      "Lekki - Eti-Osa",
      "Ikeja GRA - Ikeja"
    ],
    "customLocation": null
  }
}
```

Or with custom location:

```json
{
  "location": {
    "state": "Lagos",
    "localGovernmentAreas": ["Alimosho"],
    "selectedAreas": [],
    "customLocation": "Near New Garage, Egbeda"
  }
}
```

---

## Budget Validation Rules

### Minimum Budget Requirements by Location:

| Location | Buy (₦)   | Rent (₦) | Joint Venture (₦) | Shortlet (₦) |
| -------- | --------- | -------- | ----------------- | ------------ |
| Lagos    | 5,000,000 | 200,000  | 10,000,000        | 15,000       |
| Abuja    | 8,000,000 | 300,000  | 15,000,000        | 25,000       |
| Others   | 2,000,000 | 100,000  | 5,000,000         | 10,000       |

### Budget Validation:

- Min price must be ≥ location minimum
- Max price must be > min price
- Premium features disabled if budget below threshold

---

## Feature Budget Requirements

### Buy Property:

- **Swimming Pool:** ₦30,000,000 minimum
- **Gym:** ₦30,000,000 minimum
- **Walk-in Closet:** ₦25,000,000 minimum
- **Smart Home Features:** ₦40,000,000 minimum

### Rent Property:

- **Gated Estate:** ₦500,000 minimum
- **Furnished:** ₦800,000 minimum
- **Serviced Apartment:** ₦1,000,000 minimum
- **Backup Generator:** ₦400,000 minimum

### Joint Venture:

- **Existing Drawings:** ₦10,000,000 minimum
- **Fenced Land:** ₦5,000,000 minimum
- **High-Demand Area:** ₦20,000,000 minimum

### Shortlet:

- **Smart TV/Netflix:** ₦50,000 minimum
- **Gym:** ₦80,000 minimum
- **Swimming Pool:** ₦100,000 minimum
- **Housekeeping:** ₦60,000 minimum

---

## Error Responses

### Validation Errors:

```json
{
  "status": "error",
  "message": "Validation failed",
  "errors": [
    {
      "field": "budget.minPrice",
      "message": "₦5,000,000 is the minimum required for this location."
    },
    {
      "field": "location.areas",
      "message": "Maximum 3 areas can be selected"
    }
  ]
}
```

### Success Response:

```json
{
  "status": "success",
  "message": "Preference submitted successfully",
  "data": {
    "preferenceId": "pref_123456789",
    "submittedAt": "2024-01-01T12:00:00Z"
  }
}
```

---

## Form Validation Rules

1. **Location:** State and at least 1 LGA required
2. **Areas:** Max 3 areas OR custom location
3. **Budget:** Min < Max, meets location minimums
4. **Contact:** Valid email and phone number
5. **Property Details:** All required fields based on type
6. **Dates (Shortlet):** Check-out > Check-in, minimum 1 night

## Auto-Adjust Features

When "Auto-adjust my features to match my budget" is enabled:

- Premium features exceeding budget are automatically removed
- User is notified of changes
- Basic features remain unaffected
